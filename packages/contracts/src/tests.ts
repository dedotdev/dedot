import Keyring from '@polkadot/keyring';
import { cryptoWaitReady } from '@polkadot/util-crypto';
import { LegacyClient } from '@dedot/api';
import { WsProvider } from '@dedot/providers';
import { HexString } from '@dedot/utils';
import { FlipperApiContractApi } from '../../../flipper-api/index.js';
import { SolContract } from './SolContract';
import { SolContractDeployer } from './SolContractDeployer';
import { CREATE1, toEvmAddress } from './utils';

const flipper = (): [HexString, string] => [
  '0x50564d00002434000000000000010700c13000c00040032034e36d2ffeb3f49181c656a7b0972ccfdc0e1c97907927060656a57fa20b29260480aa0a000000000e0000001c0000002a000000300000003d0000004800000053000000650000007000000063616c6c5f646174615f636f707963616c6c5f646174615f6c6f616463616c6c5f646174615f73697a6563616c6c65726465706f7369745f6576656e746765745f73746f726167657365616c5f72657475726e7365745f696d6d757461626c655f646174617365745f73746f7261676576616c75655f7472616e73666572726564051102ac680463616c6cac70066465706c6f7906b3285e02acce65004d0152017401110240022103520467048a049604b00465056a058e05a3050307ae08c109d909e309f109190a260a5e0a990ba60b370c7e0d8b0dc20df20d090e4e0f5b0f9810b010ba10c8107211c61260131614f01422162b170d182a1834184218b11863198a19d11afc1a101b1d1bec1bf71b281d401d4c1d5a1d681d931dbb1dfb1d901e081f421fce1fc2208521e921a422ed22b82381249f25bd25c825d7253a260c29692a112ba72be72b2c2c4a2c552c702c792cc02c8b791052093b3309010001ae9833c8780883881f8488e0553801000128390a200002ae8a123d082000023308300002c8870732003308300002c88707320000009511d87b10207b15187b161082897b19088289087b1982851082861883773308205010029f6f686f59821a6faa821b086fbb787b18787a10787908787898bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bb08787b1998ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790998893878790798893078790698892878790598892078790498891878790398891078790298880878780182102082151882161095112832009511f07b10087b158475010a02013d072400025105075010040950100649039511c0fe7b1038017b1530017b162801951540018411e033074033082050100891fe46171f800046171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a461709461708461707461706461705461704461703461702461701460749219800492180004921880049219000831780000a0901821790008218980082198800821a8000d49808d4a707d487075207440295176050100a7f0b821760821868821970821a787b1a387b19307b18287b172049115849115049114895174095182049114050100c380d8317a0000a038217a8008118b0008219a0006f7a7b1a1097a7206f88988820d487077b171898a7206f96976820d487077b17084921f8004921f0004921e8004921e000492118014921100149210801492100014821c000208318e000831a0001831bc0003309ff33070a05821718017c18000182191001821a0897aa08821b108bbb18d4ba0a8b6b18986620976608821c1897cc08989928979928d4c808d4b909d469094921f8004921f0004921e8004921e0007b1718017b1910017b1a08017b1800018318e000831a00013309ff330b2033070a0833074033082050100ee4fc7c78117c79107c7a127c7b13978808d4980897aa1097bb18d4ba0ad4a8087c79157c7a147c7b167c7c17979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c760797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a197c7b187c7c1a7c761b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b1d7c7c1c7c761e7c781f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78097c7b087c7c0a7c760b978808d4b80897cc10976618d46c0cd4c8087c7b0d7c7c0c7c760e7c770f97bb08d4cb0b976610977718d46707d4b707977720d487076f776fa66f986f29d49808d47609d48909989920d48707977720d497075107170033073308501010b3fb837833070133090a06018366646733085010129efb8377330833090a01390828000251080d330730000383770a0701646733085010147bfb8378330733093300160a06019511c07b10387b15309515408411e033074033082050101855fb46171f800046171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a461709461708461707461703461702461701460739082400024617064617054617045318044f831733080a010181171c5147a9efe4cd465247c1ce642e3a33001a951120ff7b10d8007b15d0007b16c8009515e0008411e04921b8004921b0004921a8004921a0008317a0000a0928771350101ce71733001e9511c07b10387b15309515408411e0491118491110491108490183170a0928aa159511f07b10087b15647533074033082050102062fa7c78017c797c7a027c7b03978808d4980897aa1097bb18d4ba0ad4a8087c79057c7a047c7b067c7c07979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79097c7a087c7b0a7c7c0b979908d4a90997bb1097cc18d4cb0bd4b9097c7a0d7c7b0c7c7c0e7c780f97aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78117c7a107c7b127c7c13978808d4a80897bb1097cc18d4cb0bd4b8087c7a157c7b147c7c167c791797aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78197c79187c7b1a7c7c1b978808d4980897bb1097cc18d4cb0bd4b8087c791d7c7b1c7c7c1e7c771f979908d4b90997cc10977718d4c707d49707977720d487076f776fa86f396f2a7b5a187b59107b58087b5782100882159511103200951160ff7b1098007b1590007b1688009515a0008411f08289187b19308289107b19288289087b192082887b18187b173833074033082050102202f97c78197c79187c7a1a7c7b1b978808d4980897aa1097bb18d4ba0ad4a8087c791d7c7a1c7c7b1e7c7c1f979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79117c7a107c7b127c7c13979908d4a90997bb1097cc18d4cb0bd4b9097c7a157c7b147c7c167c761797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a097c7b087c7c0a7c760b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b0d7c7c0c7c760e7c780f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78017c7b7c7c027c7603978808d4b80897cc10976618d46c0cd4c8087c7b057c7c047c76067c770797bb08d4cb0b976610977718d46707d4b707977720d487076f736fa46f966f2c82181895871fd88708821a20c88a09d8a90ada880a821828c88a0ad88a08821b30c8b8088477e0c8c7077b1c287b1710d8c70bc86909c8b90cd36c097b1630d86c07da9b07c84a0ac87a0bd8ab06d84a09c83808c89808c886068eb88e69da6809d46b087b1c088ecadb890a520a2301d84b08d33609d8360ada980ad34b08d49808db8a0752070a013307403308207b14207b13187b1b50102457f76f6882196f99821a086faa821b106fbb787b1898bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bb08787b19787a1098ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11787908989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790978789889387879079889307879069889287879059889207879049889187879039889107879029888087878018217388218287b788218187b78188218307b78088218207b7810955160ff8210980082159000821688009511a0003200491170491168491160140700000000717b484e9518607b1778330750102684f6491158491150491140413307049518404911485010286cf6330824330750102a22f6837833070133092433002c0a0601827818827910827a827708d4980888a9029479948951090532009511f87b103307330850102eecf5837833070133093300300a06019511f07b10087b15828910828a18828b088288d4ba0ad4980bd4ab0b98bb20d4a909979920d4b9095209410164758387330820501032a7f57c78097c79087c7a0a7c7b0b978808d4980897aa1097bb18d4ba0ad4a8087c790d7c7a0c7c7b0e7c7c0f979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c780797aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78197c7a187c7b1a7c7c1b978808d4a80897bb1097cc18d4cb0bd4b8087c7a1d7c7b1c7c7c1e7c791f97aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78117c79107c7b127c7c13978808d4980897bb1097cc18d4cb0bd4b8087c79157c7b147c7c167c7717979908d4b90997cc10977718d4c707d49707977720d487076f776faa6f396f28d4980b88ac02947c94bc510c197b5a7b57087b58107b59188210088215951110320000330733085010346cf4837833070133093300360a06019511e07b10187b15107b1608828318829a187b1a828010828c08829b0882848295829910d3cb08d8cb06d8450ada8a06c90908c96802d86808d809098216c93606c99606c98606c9cb0bc9ab0bc945088eb9888820858801dbb9088f698e2adb690ad46209db9a0851085f016475d40407d43c08d48707987720d40808978820d48707520743018347330820501038cef37c78097c79087c7a0a7c7b0b978808d4980897aa1097bb18d4ba0ad4a8087c790d7c7a0c7c7b0e7c7c0f979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c760797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a197c7b187c7c1a7c761b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b1d7c7c1c7c761e7c781f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78117c7b107c7c127c7613978808d4b80897cc10976618d46c0cd4c8087c7b157c7c147c76167c771797bb08d4cb0b976610977718d46707d4b707977720d487076f776faa6f996f28d4980b88ac02947c94bc510c257b5a7b57087b58107b5918821018821510821608951120320000330733003a288ef23307330850103a87f28378330701330933003c0a06019511907b10687b15607b16589515708411f039062400027b17089767209877204911284911207b171095173095181049111850103e0af9821848821940821a38821730d4a808d4970ad48a0a98aa20d49808978820d4a8085208610183777b17646850104013f28377646833090a0154161f4b013308208217501042fcf17c78097c79087c7a0a7c7b0b978808d4980897aa1097bb18d4ba0ad4a8087c790d7c7a0c7c7b0e7c7c0f979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c760797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a197c7b187c7c1a7c761b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b1d7c7c1c7c761e7c781f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78117c7b107c7c127c7613978808d4b80897cc10976618d46c0cd4c8087c7b157c7c147c76167c771797bb08d4cb0b976610977718d46707d4b707977720d487076f776faa6f996f28d4980b88ac02947c94bc510c23821b087bba7bb7087bb8107bb91895519082106882156082165895117032000033073308501044b7f0837833070133093300460a0601828918828a10828b0882887b79187b7a107b7b087b783200951100ff7b10f8007b15f0007b16e800951500018411e0828918828a10828b828c087b19387b1a30d49a087b1b2888b9027b1c2094c994895109cd00827a107b1a088279087b191082787b18188276187b1ab0007b19a8007b18a0007b16b8004921d8004921d0004921c8004921c00048218000208318a000831ac000831b80003309ff33070a058217c0008218d0008219c800847700ff821ad800821b28d4b707821b20d4b909821b30d4b808821b38d4ba0a7b16b800821b087b1bb000821b107b1ba800821b187b1ba0007b1ad8007b18d0007b19c8007b17c0008318a000831ac0003309ff330b2033070a08955100ff8210f8008215f0008216e800951100013200491170491168491160140700000000717b484e9518607b17783307501048adef4911584911504911402133070495184049114850104a95ef330824330750104c4bef837833070133092433004e0a06018289828b08828218828810989c3897ba08d4ca0a98bb38978c08d4cb0b988838972208d482089799087b797b78187b7b107b7a0832009511c0fe7b1038017b1530017b162801951540018411f0827b10827c18827908827a7b19b8007b1c9000d4c907d4ba09d479099899207b1b9800d4b707977720d497075207a6068287187b17c8008287107b17c0008287087b17d80082877b17d0007b1ab00083a73308207b17a80050105093ee7c78097c79087c7a0a7c7b0b978808d4980897aa1097bb18d4ba0ad4a8087c790d7c7a0c7c7b0e7c7c0f979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c760797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a197c7b187c7c1a7c761b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b1d7c7c1c7c761e7c781f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78117c7b107c7c127c7613978808d4b80897cc10976618d46c0cd4c8087c7b157c7c147c76167c771797bb08d4cb0b976610977718d46707d4b707977720d487076f776fa66f986f29d498088869029479948951095d058219d000821ac000d4a9078218c800821bd800d4b808d48707987720d4a808978820d487075207330583973308207b17a0005010523fed78761f46171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a4617094617084617074617064617054617044617034617024617018218980082199000d4980a1406e0ffffff000000008218b000d868088219b80094987b1a980094a8460751089a048217a800837720330820501054a5ec8218c800821ac000d48a0a8218d000d868088219d80094987b1a94a851086b047c780c7b18c8007c780d7b18c0007c780e7b1890007c780f7b1888007c78107b1880007c78117b18787c78127b18707c78137b18687c78147b18607c78157b18587c78167b18507c78177b18487c78187b18407c78197b18387c781a7b18307c781b7b18287c781c7b18207c781d7b18187c781e7b18107c771f7b1708140600000000ffffffff8217a000837720330820501056efeb82180878781f82181078781e82181878781d82182078781c82182878781b82183078781a821838787819821840787818821848787817821850787816821858787815821860787814821868787813821870787812821878787811821880007878108218880078780f8218900078780e8218c00078780d8218c80078780c98681078780a9868087878091408c0ffffff000000008219b000d889088219b800949882199800949846170b7b16c800787608461707461706461705461704461703461702461701460751080a038217a80083774033082050105815eb7c78117c79107c7a127c7b13978808d4980897aa1097bb18d4ba0ad4a8087c79157c7a147c7b167c7c17979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c760797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a197c7b187c7c1a7c761b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b1d7c7c1c7c761e7c781f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78097c7b087c7c0a7c760b978808d4b80897cc10976618d46c0cd4c8087c7b0d7c7c0c7c760e7c770f97bb08d4cb0b976610977718d46707d4b707977720d487076f786fa76f996f2ad4a909d4870ad49a0a98aa20d49808978820d4a8085208d301837733082050105ae3e91408c0ffffff000000008219d000d889088219d8009498821994985108aa017c78197c79187c7a1a7c7b1b978808d4980897aa1097bb18d4ba0ad4a8087c791d7c7a1c7c7b1e7c7c1f979908d4a90997bb1097cc18d4cb0bd4b909979920d498087c79117c7a107c7b127c7c13979908d4a90997bb1097cc18d4cb0bd4b9097c7a157c7b147c7c167c761797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a097c7b087c7c0a7c760b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b0d7c7c0c7c760e7c770f97bb08d4cb0b976610977718d46707d4b707977720d4a707821ac800d2a7077b17d8008499ff7b19d0008486ff8217a00083774033082050105cdae84617074617064617054617044617034617024617014607787618821ad000787a108219d80078790898683878781f98683078781e98682878781d98682078781c98681878781b98681078781a98660878761998a83878781798a83078781698a82878781598a82078781498a81878781398a81078781298a80878781198983878780f98983078780e98982878780d98982078780c98981878780b98981078780a9898087878099551c0fe82103801821530018216280195114001320000492110014921080149210001140700000000717b484e951800017b171801330750105e38e84921f8004921f0004921e000213307049518e0004921e8005010601be83308243307501062d1e783783307013309243300640a06019511807b10787b15707b1668951580008411f07b171082878292828b08829308957a607b1a18d87a06c86b0a7b1a08d8ba0cda660c828a10828818829410829918c8ca06d8a60cc88c0c7b1c7b18387b1a307b1b287b17207b19587b14507b13489517409518207b124050106652f88218108217087b87088217187b877b861082177b87189551808210788215708216689511800032008217b0008218b8008219a800821aa000d49808d4a707d48707520701023907240002541703f80195178000330068951120fe7b10d8017b15d0017b16c8019515e0018411e07b17389517400133009000951110ff7b10e8007b15e0007b16d8009515f0008411f07b17284921a8004921a00049219000609517b0009518900049219800330084002867ed821780007b1738821788007b1730821790007b1728821798007b172033074033082050106a7be67c78017c797c7a027c7b03978808d4980897aa1097bb18d4ba0ad4a8087c79057c7a047c7b067c7c07979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79097c7a087c7b0a7c7c0b979908d4a90997bb1097cc18d4cb0bd4b9097c7a0d7c7b0c7c7c0e7c760f97aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a117c7b107c7c127c761397aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b157c7c147c76167c781797bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78197c7b187c7c1a7c761b978808d4b80897cc10976618d46c0cd4c8087c7b1d7c7c1c7c761e7c771f97bb08d4cb0b976610977718d46707d4b707977720d487076f7b7b1b086fa87b18106f966f297b19188217207b17788217287b17708217307b17688217387b17607b19587b16507b18489517609518407b1b4050106c32f6821908821718821810d48707d46908d47808988820d46707977720d48707510717003307330850106e09e5837833070133090a06018397330860501070f5e4837833096033073300720a0601828918828a10828b0882887b79187b7a107b7b087b783200821710821818821908821ad49808d4a707d487075207d6013907240002541703cd01330074951100fe7b10f8017b15f0017b16e801951500028411e04921d8014921d0014921c8014921c001492158014921500149214801492140013306207a16a0018318c001831a4001831ba0013309ff33070a057c1740017b17384921d8014921d0014921c8014921c001492158014921500149214801492140017a16a0018318c001831a4001831ba0013309ff33070a0528fd0a3307403308205010760ee47c78117c79107c7a127c7b13978808d4980897aa1097bb18d4ba0ad4a8087c79157c7a147c7b167c7c17979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c780797aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78197c7a187c7b1a7c7c1b978808d4a80897bb1097cc18d4cb0bd4b8087c7a1d7c7b1c7c7c1e7c791f97aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78097c79087c7b0a7c7c0b978808d4980897bb1097cc18d4cb0bd4b8087c790d7c7b0c7c7c0e7c770f979908d4b90997cc10977718d4c707d49707977720d487076f786fa76f396f2ad4a909d4870ad49a0a98aa20d49808978820d4a80851081e0033073308501078dde2837833070133090a06837733007a28cae2837750107ac5e283783307330933007c0a06019511f87b103307330850107eabe283783307013309330080000a06019511a07b10587b15507b16489515608411f064764911184911104901609517206418491108502082003ae9821730821838821920821a287b67107b68187b697b6a089551a082105882155082164895116032008218c8008216c0008217b8008219b0007b17487b1838d48707d46908d47808988820d46707977720d487075207db0283973308207b17307b1940502086000be246171f46171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a4617094617084617074617064617054617044617034617024617017b1618821938d469091408e0ffffff00000000821a40d88a08821a4894a87b192094984607510844028217308377203308205020880076e146171f46171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a46170946170846170746170646170546170446170346170246170146074911684911604911502095177095185049115850208a00c5e782188800821680008217788219707b17107b1808d48707d46908d47808988820d46707977720d48707520790017b19839733082050208c00c4e01408c0ffffff00000000821940d889088219489498821920949846171f46171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a46170946170846170746170646170546170446170346170246170146075108060182173083774033082050208e0038e08218086f886f69821a106faa821b6fbb98bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bc08787c19787b18787a1098ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11787908989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790978789889387879079889307879069889287879059889207879049889187879039889107879029888087878018217288218407b788218387b78188218487b78088218187b7810955110ff8210e8008215e0008216d8009511f000320000492198014921900149218801492180014921b8014921b0014921a8014921a0014821c0012083188001831aa001831bc0013309ff33070a057c17a0017b1768492198014921900149218801492180014921b8014921b0014921a8014921a0014821c0012083188001831aa001831bc0013309ff33070a058217a0017b17508217a8017b17408217b0017b1748831760010a03801770017b1778821768017b177082166001492118014921100149210001209517200195180001492108015020920048e5821838018219300182172801821a20017b17307b1820d48707d49a08d478089888207b1928d49707977720d487075207c5036f679777208218706f88988920d497077b17709788208217786f77987720d487077b17787b1a1883a7330820502094001dde8218786f888219706f99986a18787a0f986a10787a0e986a08787a0d78760c46170b46170a4617094617084617074617064617054617044617034617024617014607787910787818989a38787a17989a30787a16989a28787a15989a20787a14989a18787a13989a10787a1298990878791198893878791f98893078791e98892878791d98892078791c98891878791b98891078791a9888087878194921d8004921d0004921c000609517e0009518c0004921c8005020960029e4821868551802d2028219f8008216f0008217e0008218e8007b1778d467077b18707b1960d49808d48707987720d46808978820d4870752079e028117783308207b17585020980019dd82186878781f46171e46171d46171c46171b46171a46171946171846171746171646171546171446171346171246171146171046170f46170e46170d46170c46170b46170a4617094617084617074617064617054617044617034617024617017b1608821a60d46a0a140800000000010000007b18101408e0ffffff00000000821978d8890882197094987b1a6894a846075108f901821948979738821a4098a808d487077b1797a738821850988808d487077b175097971898762082175883772033082050209a004edc6f6882196f99821a506faa98ab38787b1f98ab30787b1e98ab28787b1d98ab20787b1c98ab18787b1b98ab10787b1a98ab08787b19787a1878791046170b46170a4617094617074617064617054617044617034617024617014607989a38787a17989a30787a16989a28787a15989a20787a14989a18787a13989a10787a1298990878791178780898893878790f98893078790e98892878790d9888208219109599c0821a78d89a09821a7094a9821a6894a978780c51090a0182175883774033082050209c0085db8218206f888219286f99821a306faa821b186fbb98bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bc08787c19787b18787a1098ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11787908989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790978789889387879079889307879069889287879059889207879049889187879039889107879029888087878018217388218787b788218607b78188218707b78088218087b7810955120fe8210d8018215d0018216c8019511e0013200004921b0004921a8004921a000140700000000717b484e9518a0007b17b800330750209e00a7da4921980049219000492180002133070495188000492188005020a00089da33082433075020a2003eda83783307013309243300a4000a0601828918828a10828b0882887b79187b7a107b7b087b783200828910828a18828b088288d4ba0ad4980bd4ab0b98bb20d4a909979920d4b9095209d6009511e07b10187b15107b1608827910827a087b1a827697992098952083873308205020a600ccd96f5882196f996f6a98ab38787b1f98ab30787b1e98ab28787b1d98ab20787b1c98ab18787b1b98ab10787b1a98ab08787b19787a1878791046170b46170a4617094617074617064617054617044617034617024617014607989a38787a17989a30787a16989a28787a15989a20787a14989a18787a13989a10787a1298990878791178780898893878790f98893078790e98892878790d98882078780c8210188215108216089511203200007c1740015517029c045107514921d8014921d0014921c8014921c001492158014921500149214801492140014821a001208318c001831a4001831ba0013309ff33070a05821740018218480182195001821a5801847700ff28524921d8014921d0014921c8014921c001492158014921500149214801492140014821a001208318c001831a4001831ba0013309ff33070a05821740018218480182195001821a5801847700ff867701014921d8014921d0014921c8014921c0017b1a58017b1950017b1848017b1740018318c001831a40013309ff330b2033070a08831700010a038217080181181001821900016f7a7b1a2897a7206f88988820d487077b173098a7206f96976820d487077b17204921d8014921d0014921c8014921c001492158014921500149214801492140014821a001208318c001831a4001831ba0013309ff33070a05821758017c18400182195001821a2097aa08821b288bbb18d4ba0a8b6b18986620976608821c3097cc08989928979928d4c808d4b909d469094921d8014921d0014921c8014921c0017b1758017b1950017b1a48017b1840018318c001831a40013309ff330b2033070a084921d8014921d0014921c8014921c001492158014921500149214801492140014821a001208318c001831a4001831ba0013309ff33070a057c164001831720010a0301821838551802e3027b16305516022003801730017b1720821728017b1718821720017b17283307403308205020a800fad67c78117c79107c7a127c7b13978808d4980897aa1097bb18d4ba0ad4a8087c79157c7a147c7b167c7c17979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79017c7a7c7b027c7c03979908d4a90997bb1097cc18d4cb0bd4b9097c7a057c7b047c7c067c760797aa08d4ba0a97cc10976618d46c0cd4ca0a97aa20d4a9097c7a197c7b187c7c1a7c761b97aa08d4ba0a97cc10976618d46c0cd4ca0a7c7b1d7c7c1c7c761e7c781f97bb08d4cb0b976610978818d46808d4b808978820d48a0a7c78097c7b087c7c0a7c760b978808d4b80897cc10976618d46c0cd4c8087c7b0d7c7c0c7c760e7c770f97bb08d4cb0b976610977718d46707d4b707977720d487076f786fa76f996f2ad4a909d4870ad49a0a98aa20d49808978820d4a808520855018216286f689788208219186f99989a20d4a8087b18189799208218206f88988820d498087b181083777b17203308205020aa009dd58218106f888219186f99986a18787a0f986a10787a0e986a08787a0d78760c46170b46170a4617094617084617074617064617054617044617034617024617014607787910787818989a38787a17989a30787a16989a28787a15989a20787a14989a18787a13989a10787a1298990878791198893878791f98893078791e98892878791d98892078791c98891878791b98891078791a9888087878193308208217205020ac00f5d43a080000023a090800023a0a1000023a0b1800027b1858017b1950017b1a48017b1b40018218389788387b1878014921700149216801492160018218309788387b189801492190014921880149218001837983174001330803330a200a04955100fe8210f8018215f0018216e80195110002320000491170491168491160140700000000717b484e9518607b177833075020ae009fd4491158491150491140213307049518404911483300b4002882d44921b0004921a8004921a000140700000000717b484e9518a0007b17b80033075020b0005fd44921980049219000492180002133070495188000492188003300b400283dd44921f0004921e8004921e000140700000000717b484e9518e0007b17f80033075020b2001ad44921d8004921d0004921c000213307049518c0004921c8005020b400fcd333082433075020b600b1d383783307013309240a0633073300b80028ced433075020b800c9d43307015020ba00c0d49511b07b10487b15409515508411f08272827308827b10827718828c828908828a108288187b18187b1a107b19087b1c7b17387b1b307b132895172064187b12205020bc0035f99551b0821048821540951150320049489220248414d249525252a22a2529499224499224499224499224499224499224499224494a4a4322444444921092244992244992244992242922221a11912412922449922409514494942425898888880811918a8824499224491211111111915412922449922449922449499224499224499224499224499224499224499224499224554992242b945a85ea90502b54699224092149922449922449922449214954130824222212111125244992a44a5249484992244992244992244992244992244992244992244992244992244992244992542529a58888489224254948922449922449922449922449922449922449922449922449529224499224499254254992244992244992244952494a244992489242955292244992244992244992244992244992a42449922449929224898888920490149248125228499392544a154a69529292244954429224499224499224294992244992244992244992244992244992244992244992a42aa99424a5154a69922425a9244992942449492a49942449a2842449922449922449529224499224499224499224499224499224499224499224495552294992b4a442294d92242449922424499224892a548714922449922449922449499224499224499224499224499224499224499224499224554925254992b442294d52928a8888242549928a2429898888880811918a8888244992482412111111494544444902480a4924092994a425499224494a524444244911491249229148145122244992244992244992922449922449922449922449922449922449922449922449aa928a88442449122542922449922449922449922489480091282a220911894415894422914892244992244992244992248048429224499224499224499224914824124992002251944892242922094992244992244992a4244992244992244992244992244992244992244992244992aa244912250410892a92244992244992244992244992244992244992244992244992482412494892242512499224499224499224499224499224492222a21111404421222422a45092264924952449922449529224491292a494248922229244089188884822222222890811118944229124a424499224499224499224499224499224499224499224499224499224499224494aa924499224491292244992ac506a09a53449492a49492284444444222222221211918a444444444444a49284244992244992244952922449922449922449922449922449922449922449922449559224c90aa54a0a559a2a94a249929424254892a424498a88489224499424489224499224499224499224490248522a92044992244992244992244992a42492041149922449a2120490a49424499224499224499224498a24412a5592244992244992244992244992244992a424499224499292248988884644444484884845222222224244a422914814894444888820222249922489929224254909524a9224499224494a9224499224499224499224224444901011912449924492204992244992244992244992244900092049a948929424499204554a9224499224499224494a922449922449922449524a2409524a29499224499224499224499224499224495292244992244949924444442322808882889088200525d12425a9242549924892a4921254254992244992244992242549922449922449922469844444444484884845444411111111212252111191111111111149451151529294242222222244442a2292244992244944444444445211111111212252114d48884422499024499224499224494a9224499224499224499224499224499224499224499224a94a922491929224252909524a9224499224494a922449922449922449922409420821222289884822228aa4888868920092822492442222808882889088484404105110111211a4a0a422050992242529499292a404491200',
  `
[
	{
		"inputs": [
			{
				"internalType": "enum Flipper.State",
				"name": "initState",
				"type": "uint8"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "enum Flipper.State",
				"name": "oldState",
				"type": "uint8"
			},
			{
				"indexed": true,
				"internalType": "enum Flipper.State",
				"name": "newState",
				"type": "uint8"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "caller",
				"type": "address"
			}
		],
		"name": "Flipped",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "flip",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "retrieve",
		"outputs": [
			{
				"components": [
					{
						"internalType": "enum Flipper.State",
						"name": "state",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "lastFlipped",
						"type": "address"
					},
					{
						"components": [
							{
								"internalType": "address",
								"name": "owner",
								"type": "address"
							}
						],
						"internalType": "struct Flipper.FutherInfo",
						"name": "info",
						"type": "tuple"
					}
				],
				"internalType": "struct Flipper.RetrieveInfo",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
] 
    `,
];

const run = async () => {
  await cryptoWaitReady();
  const alicePair = new Keyring({ type: 'sr25519' }).addFromUri('//Alice');
  const api = await LegacyClient.new(new WsProvider('ws://localhost:9944'));

  const [code, abi] = flipper();

  const deployer = new SolContractDeployer<FlipperApiContractApi>(api, abi, code, { defaultCaller: alicePair.address });

  const dryRunDeploy = await deployer.query.initialize(0);

  console.log('Dry run results:', dryRunDeploy);

  const nonce = await api.call.accountNonceApi.accountNonce(alicePair.address);
  const contractAddress = CREATE1(toEvmAddress(alicePair.address), nonce);

  console.log('Trying deploy contract...');

  await deployer.tx
    .initialize(0, {
      gasLimit: dryRunDeploy.raw.gasRequired,
      storageDepositLimit: dryRunDeploy.raw.storageDeposit.value,
    })
    .signAndSend(alicePair)
    .untilFinalized();

  console.log('Contratct deployed at address:', contractAddress);

  const contract = new SolContract<FlipperApiContractApi>(api, abi, contractAddress, {
    defaultCaller: alicePair.address,
  });

  const {
    data: [retrieveInfo],
  } = await contract.query.retrieve();

  console.log('Retrieve info:', retrieveInfo.lastFlipped, retrieveInfo.state, retrieveInfo.info.owner);

  const dryRunFlip = await contract.query.flip();

  console.log('Dry run flip results:', dryRunFlip);

  await contract.tx
    .flip({
      gasLimit: dryRunFlip.raw.gasRequired,
      storageDepositLimit: dryRunFlip.raw.storageDeposit.value,
    })
    .signAndSend(alicePair)
    .untilFinalized();

  console.log('Flip executed successfully.');

  const updatedRetrieveInfo = await contract.query.retrieve();

  console.log('Updated retrieve info:', updatedRetrieveInfo);

  await api.disconnect();
};

run().catch(console.error);
